flowchart LR
  subgraph Clients
    CLI[TUI CLI]
    SDK[SDK Client]
    Desktop[Desktop App]
    Web[Web/Console]
  end

  subgraph Core[OpenCode Core (packages/opencode)]
    API[Hono HTTP API + SSE/WebSocket]
    Session[Session + Message Store]
    LLM[LLM Stream Orchestrator]
    Tools[Tool Registry + MCP]
    Bus[Event Bus]
  end

  Storage[(Local JSON Storage)]
  FS[(Workspace Files)]
  Providers[(LLM Providers)]
  MCP[(MCP Servers)]

  CLI --> API
  SDK --> API
  Desktop --> API
  Web --> API

  API --> Session
  API --> Bus
  Session --> Storage
  LLM --> Providers
  LLM --> Tools
  Tools --> FS
  Tools --> MCP
  Bus --> API
