sequenceDiagram
  participant Model
  participant Router
  participant Registry
  participant Handler
  participant Session

  Model->>Router: ResponseItem::FunctionCall
  Router->>Registry: dispatch(tool_name, payload)
  Registry->>Handler: handle(invocation)
  Handler-->>Registry: ToolOutput
  Registry-->>Session: ResponseInputItem::FunctionCallOutput
  Session-->>Model: next turn includes tool output
